<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Dashboard - CHYLNX HUB</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100 min-h-screen p-6">

  <h1 class="text-3xl font-bold mb-6 text-center">Admin Dashboard</h1>

  <div class="flex justify-between items-center mb-4">
    <h2 class="text-xl font-semibold">Users & Payments</h2>
    <form action="/toggle_chat_lock" method="POST">
      <button type="submit" class="bg-green-600 text-white px-4 py-2 rounded">
        {{ 'Unlock Chat' if chat_locked else 'Lock Chat' }}
      </button>
    </form>
  </div>
<!-- Add this to your admin_dashboard.html -->
<div class="admin-section">
    <h3>Weekly Challenge Manual Control</h3>
    
    <!-- Manual Message Control -->
    <div class="control-group">
        <h4>Change Completion Message</h4>
        <input type="text" id="weeklyMessageInput" placeholder="Enter new completion message" 
               value="WEEKLY CHALLENGE: COMPLETED" class="form-control">
        <button onclick="updateWeeklyMessage()" class="btn btn-primary mt-2">
            Update Message
        </button>
    </div>

    <!-- Manual Trigger -->
    <div class="control-group mt-3">
        <h4>Manual Trigger</h4>
        <button onclick="triggerWeeklyCompletion()" class="btn btn-warning">
            Trigger Weekly Challenge Completion
        </button>
        <button onclick="stopWeeklyChallenge()" class="btn btn-danger ml-2">
            Stop Weekly Challenge
        </button>
    </div>

    <!-- Set New Weekly Challenge -->
    <div class="control-group mt-3">
        <h4>Set New Weekly Challenge</h4>
        <input type="number" id="weeklyDays" placeholder="Days" min="1" max="30" class="form-control d-inline w-auto">
        <button onclick="startWeeklyChallenge()" class="btn btn-success ml-2">
            Start New Challenge
        </button>
    </div>
</div>

<script>
// Get the current custom message from input
function getWeeklyMessage() {
    return document.getElementById('weeklyMessageInput').value.trim() || 'WEEKLY CHALLENGE: COMPLETED';
}

// Update the message that will be broadcast
function updateWeeklyMessage() {
    const newMessage = getWeeklyMessage();
    alert('Message updated to: ' + newMessage);
    console.log('Weekly challenge message set to:', newMessage);
}

// Manually trigger weekly challenge completion
function triggerWeeklyCompletion() {
    const message = getWeeklyMessage();
    
    // Emit event to server with custom message
    socket.emit('manual_weekly_complete', {
        message: message
    });
    
    alert('Weekly challenge completion triggered with message: ' + message);
}

// Stop the weekly challenge
function stopWeeklyChallenge() {
    socket.emit('set_weekly_challenge', {
        action: 'stop'
    });
    alert('Weekly challenge stopped');
}

// Start a new weekly challenge
function startWeeklyChallenge() {
    const days = parseInt(document.getElementById('weeklyDays').value) || 7;
    
    socket.emit('set_weekly_challenge', {
        action: 'start',
        days: days
    });
    
    alert('New weekly challenge started for ' + days + ' days');
}
</script>

<style>
.control-group {
    padding: 15px;
    border: 1px solid #ddd;
    border-radius: 5px;
    margin-bottom: 10px;
}

.control-group h4 {
    margin-top: 0;
    color: #333;
}

.form-control {
    display: block;
    width: 100%;
    padding: 8px;
    margin-bottom: 10px;
}

.btn {
    padding: 8px 15px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
}

.btn-primary { background-color: #007bff; color: white; }
.btn-warning { background-color: #ffc107; color: black; }
.btn-danger { background-color: #dc3545; color: white; }
.btn-success { background-color: #28a745; color: white; }

.mt-2 { margin-top: 10px; }
.mt-3 { margin-top: 15px; }
.ml-2 { margin-left: 10px; }
.d-inline { display: inline-block; }
.w-auto { width: auto !important; }
</style>
  <table class="min-w-full bg-white shadow rounded-lg">
    <thead>
      <tr>
        <th class="py-2 px-4 border-b">ID</th>
        <th class="py-2 px-4 border-b">Username</th>
        <th class="py-2 px-4 border-b">Email</th>
        <th class="py-2 px-4 border-b">Last Payment Status</th>
        <th class="py-2 px-4 border-b">Last Payment Amount</th>
        <th class="py-2 px-4 border-b">Payment Date</th>
      </tr>
    </thead>
    <tbody>
      {% for user in users %}
      <tr class="text-center">
        <td class="py-2 px-4 border-b">{{ user.id }}</td>
        <td class="py-2 px-4 border-b">{{ user.username }}</td>
        <td class="py-2 px-4 border-b">{{ user.email or '-' }}</td>
        <td class="py-2 px-4 border-b">{{ user.last_payment_status or 'None' }}</td>
        <td class="py-2 px-4 border-b">{{ user.last_payment_amount or '-' }}</td>
        <td class="py-2 px-4 border-b">{{ user.last_payment_date or '-' }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

</body>
</html>
